<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Amaze UI Admin index Examples</title>
    <meta name="description" content="这是一个 index 页面">
    <meta name="keywords" content="index">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="icon" type="image/png" href="assets/i/favicon.png">
    <link rel="apple-touch-icon-precomposed" href="assets/i/app-icon72x72@2x.png">
    <meta name="apple-mobile-web-app-title" content="Amaze UI" />

    <!-- include libraries(jQuery, bootstrap) -->
    <link href="http://netdna.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.css" rel="stylesheet">
    <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.js"></script>

    <!-- include summernote css/js -->
    <!-- <link href="https://cdn.staticfile.org/summernote/0.8.3/summernote.css" rel="stylesheet">
    <script src="https://cdn.staticfile.org/summernote/0.8.3/summernote.js"></script> -->
    <link rel="stylesheet" href="http://kindeditor.net/ke4/themes/default/default.css" />
    <script charset="utf-8" src="assets/js/kindeditor-all-min.js"></script>
    <script charset="utf-8" src="assets/js/kindeditor-zh-CN.js"></script>

    <link rel="stylesheet" href="https://cdn.staticfile.org/amazeui/2.7.2/css/amazeui.min.css" />
    <link rel="stylesheet" href="assets/css/amazeui.datatables.min.css" />
    <link rel="stylesheet" href="assets/css/app.css">

    <link href="https://cdn.bootcss.com/bootstrap-select/2.0.0-beta1/css/bootstrap-select.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/bootstrap-select/2.0.0-beta1/js/bootstrap-select.min.js"></script>


</head>

<body data-type="widgets">
    <script src="assets/js/theme.js"></script>
    <div class="am-g tpl-g">
        <!-- 头部 -->
        <header>
            <!-- logo -->
            <div class="am-fl tpl-header-logo">
                <a href="javascript:;"><img src="assets/img/logo.png" alt=""></a>
            </div>
            <!-- 右侧内容 -->
            <div class="tpl-header-fluid">
                <!-- 侧边切换 -->
                <div class="am-fl tpl-header-switch-button am-icon-list">
                    <span>

                </span>
                </div>
                <!-- 搜索 -->
                <div class="am-fl tpl-header-search">
                    <form class="tpl-header-search-form" action="javascript:;">
                        <button class="tpl-header-search-btn am-icon-search"></button>
                        <input class="tpl-header-search-box" type="text" placeholder="搜索内容...">
                    </form>
                </div>
                <!-- 其它功能-->
                <div class="am-fr tpl-header-navbar">
                    <ul>
                        <!-- 欢迎语 -->
                        <li class="am-text-sm tpl-header-navbar-welcome">
                            <a href="javascript:;">欢迎你, <span>管理员</span> </a>
                        </li>

                        <!-- 退出 -->
                        <li class="am-text-sm">
                            <a href="javascript:;">
                                <span class="am-icon-sign-out"></span> 退出
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

        </header>
        <!-- 风格切换 -->
        <div class="tpl-skiner">
            <div class="tpl-skiner-toggle am-icon-cog">
            </div>
            <div class="tpl-skiner-content">
                <div class="tpl-skiner-content-title">
                    选择主题
                </div>
                <div class="tpl-skiner-content-bar">
                    <span class="skiner-color skiner-white" data-color="theme-white"></span>
                    <span class="skiner-color skiner-black" data-color="theme-black"></span>
                </div>
            </div>
        </div>
        <!-- 侧边导航栏 -->
        <div class="left-sidebar">
            <!-- 用户信息 -->
            <div class="tpl-sidebar-user-panel">
                <div class="tpl-user-panel-slide-toggleable">
                    <div class="tpl-user-panel-profile-picture">
                        <img src="assets/img/user04.png" alt="">
                    </div>
                    <span class="user-panel-logged-in-text">
                        <i class="am-icon-circle-o am-text-success tpl-user-panel-status-icon"></i>
                        管理员
                    </span>
                </div>
            </div>

            <!-- 菜单 -->
            <ul class="sidebar-nav">
                <li class="sidebar-nav-heading">Components <span class="sidebar-nav-heading-info"> 附加组件</span></li>
                <li class="sidebar-nav-link">
                    <a href="a_index.html">
                        <i class="am-icon-home sidebar-nav-link-logo"></i> 文章列表
                    </a>
                </li>
                <li class="sidebar-nav-link">
                    <a href="a_links.html">
                        <i class="am-icon-table sidebar-nav-link-logo"></i> 外部链接
                    </a>
                </li>
                <li class="sidebar-nav-link">
                    <a href="a_edit.html" class="active">
                        <i class="am-icon-wpforms sidebar-nav-link-logo"></i> 文章编辑
                    </a>
                </li>
                <li class="sidebar-nav-link">
                    <a href="a_focus.html">
                        <i class="am-icon-bar-chart sidebar-nav-link-logo"></i> 图片轮播
                    </a>
                </li>
                <li class="sidebar-nav-link">
                    <a href="a_navi.html">
                        <i class="am-icon-bar-chart sidebar-nav-link-logo"></i> 导航菜单
                    </a>
                </li>
            </ul>
        </div>

        <!-- 内容区域 -->
        <div class="tpl-content-wrapper">

            <div class="container-fluid am-cf">
                <div class="row">
                    <div class="am-u-sm-12 am-u-md-12 am-u-lg-9">
                        <div class="page-header-heading"><span class="am-icon-home page-header-heading-icon"></span> 编辑
                            <small>Amaze UI</small>
                        </div>
                        <p class="page-header-description">文章编辑，支持富文本</p>
                    </div>
                    <div class="am-u-lg-3 tpl-index-settings-button">
                    </div>
                </div>

            </div>

            <div class="row-content am-cf">

                <div class="row">

                    <div class="am-u-sm-12 am-u-md-12 am-u-lg-12">
                        <div class="widget am-cf">
                            <div class="widget-head am-cf">
                                <div class="widget-title am-fl">边框表单</div>
                                <div class="widget-function am-fr">
                                    <a href="javascript:;" class="am-icon-cog"></a>
                                </div>
                            </div>
                            <div class="widget-body am-fr">

                                <form class="am-form tpl-form-border-form tpl-form-border-br">
                                    <div class="am-form-group">
                                        <label for="user-name" class="am-u-sm-3 am-form-label">标题</label>
                                        <div class="am-u-sm-9">
                                            <input type="text" class="tpl-form-input" id="title" placeholder="请输入标题文字" value="{{ article.title }}">
                                            <small>请填写标题文字10-20字左右。</small>
                                        </div>
                                    </div>

                                    <div class="am-form-group">
                                        <label class="am-u-sm-3 am-form-label">摘要</label>
                                        <div class="am-u-sm-9">
                                            <input type="text" id='sub_title' placeholder='请输入摘要' value="{{ article.sub_title }}">
                                            <small>请填写摘要文字100字左右。</small>
                                        </div>
                                    </div>

                                    <div class="am-form-group">
                                        <label for="user-phone" class="am-u-sm-3 am-form-label">作者</label>
                                        <div class="am-u-sm-9">
                                            <!--<select data-am-selected="{searchBox: 1}" style="display: none;">-->
                                            <!--<option value="a">-The.CC</option>-->
                                            <!--<option value="b">夕风色</option>-->
                                            <!--<option value="o">Orange</option>-->
                                            <!--</select>-->
                                            <input type="text" id='author' class="tpl-form-input" placeholder="请输入作者" value="{{ article.author }}">

                                        </div>
                                    </div>

                                    <div class="am-form-group">
                                        <label for="user-weibo" class="am-u-sm-3 am-form-label">封面图</label>
                                        <div class="am-u-sm-9">
                                            <div class="am-form-group am-form-file">
                                                <div class="img_holder" , id="img_holder">
                                                    <!--<img src="assets/img/a5.png" alt="">-->
                                                    <!--<img src="assets/img/a5.png" alt="">-->
                                                    {% if len(article.thumbnail) > 0 %} <img id="thumbnail" src="{{ article.thumbnail }}" alt=""> {% end %}

                                                </div>
                                                <button type="button" class="am-btn am-btn-danger am-btn-sm">
                                                <i class="am-icon-cloud-upload"></i> 添加封面图片
                                            </button>
                                                <input id="upload" type="file" multiple="">
                                            </div>

                                        </div>
                                    </div>

                                    <div class="am-form-group">
                                        <label for="user-weibo" class="am-u-sm-3 am-form-label">添加标签</label>
                                        <div class="am-u-sm-9">
                                            <input type="text" id="article_tags" placeholder='请添加标签多个用英文分号(;)隔开' value="{{ article.article_tags }}">
                                            <div>

                                            </div>
                                        </div>
                                    </div>


                                    <div class="am-form-group">
                                        <label for="user-weibo" class="am-u-sm-3 am-form-label">搜索关键字</label>
                                        <div class="am-u-sm-9">
                                            <input type="text" id="keywords" placeholder='请添加关键字多个用英文逗号(,)隔开' value="{{ article.keywords }}">
                                        </div>
                                    </div>

                                    <div class="am-form-group">
                                        <label for="user-phone" class="am-u-sm-3 am-form-label">导航分类</label>
                                        <div class="am-u-sm-9">
                                            <select class="selectpicker" data-hide-disabled="true">

                                                    <option> </option>

                                                    {% for item in classes %}
                                                        {% if item.name == article.classify %} 
                                                        <option selected>{{item.name}}</option> 
                                                        {% else %}
                                                        <option>{{item.name}}</option> 
                                                        {% end %}
                                                    {% end %}

                                            </select>
                                        </div>
                                    </div>

                                    <div class="am-form-group">
                                        <label for="user-weibo" class="am-u-sm-3 am-form-label">展示栏目</label>
                                        <div class="am-u-sm-9" style="padding-top: 4px;font-size:15px;color:#999">
                                            <label class="checkbox-inline">
                                                <input type="checkbox" id="is_index" value="" {% if article.is_index==1 %} checked="" {% end %}> 首页列表
                                            </label>
                                            <label class="checkbox-inline">
                                                <input type="checkbox" id='is_hot' value="" {% if article.is_hot==1 %} checked="" {% end %}> 热门推荐
                                            </label>
                                            <label class="checkbox-inline">
                                                <input type="checkbox" id='is_top' value="" {% if article.is_top==1 %} checked="" {% end %}> 文章置顶
                                            </label>
                                        </div>
                                    </div>

                                    <div class="am-form-group">
                                        <label for="user-intro" class="am-u-sm-3 am-form-label">文章内容</label>

                                        <div class="am-u-sm-9">
                                            <textarea name="content" style="height:500px;visibility:hidden;"></textarea>
                                        </div>

                                    </div>

                                    <div class="am-form-group">
                                        <div class="am-u-sm-9 am-u-sm-push-3">
                                            <button type="button" class="am-btn am-btn-primary tpl-btn-bg-color-success " onclick="submitAction()">提交</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>
    </div>
    <script src="assets/js/amazeui.datatables.min.js"></script>
    <script src="assets/js/dataTables.responsive.min.js"></script>
    <script src="assets/js/app.js"></script>

    <script>
        var editor;
        KindEditor.ready(function(K) {
            editor = K.create('textarea[name="content"]', {
                uploadJson: '/kd_upload_json',
                fileManagerJson: '/kd_file_manager_json',
                allowFileManager: true
            });
            var html = '{% raw article.content %}';
            editor.insertHtml(html);
        });

        // 获取封面图
        (function() {
            var file = {
                upload: function(e) {
                    var file = e.target.files[0];

                    var reader = new FileReader();
                    reader.readAsDataURL(file);

                    reader.onloadend = function(e) {
                        var dataURL = reader.result;
                        var image = '<img id="thumbnail" src="' + dataURL + '"' + '/>';
                        $(".img_holder").html(image);
                    };
                },
                event: function() {
                    $("#upload").change(function(e) {
                        file.upload(e);
                    });
                },
                init: function() {
                    this.event();
                }
            }
            file.init();
        }());

        function submitAction() {

            var title = document.getElementById("title").value;
            var author = document.getElementById('author').value;
            var sub_title = document.getElementById('sub_title').value;
            var content = editor.html().replace(/[\r\n]/g, "")
            var article_tags = document.getElementById('article_tags').value;
            var is_hot = $("#is_hot").is(':checked') ? 1 : 0;
            var thumbnail = $('#thumbnail').attr("src")
            var is_index = $("#is_index").is(':checked') ? 1 : 0;
            var classify = $(".selectpicker").val()
            var keywords = document.getElementById('keywords').value;
            var is_top = $("#is_top").is(':checked') ? 1 : 0;

            if (title == "") {
                alert("请输入文章标题~");
                return
            }
            if (author == '') {
                alert("请输入作者~");
                return
            }
            if (content == '' || content == '<p><br></p>') {
                alert('请输入文章内容~');
                return
            }

            var params = {
                'title': title,
                'author': author,
                'content': content,
                'sub_title': sub_title,
                'article_tags': article_tags,
                'is_hot': is_hot,
                'thumbnail': thumbnail,
                'is_index': is_index,
                'classify': classify,
                'keywords': keywords,
                'is_top': is_top
            }

            params['id'] = '{{ article.id }}'

            $.ajax({
                type: "POST",
                url: "upload_article",
                data: params,
                success: function(msg) {
                    if (msg == '保存成功') {
                        window.location.href = "a_index.html"
                    } else {
                        alert(msg)
                    }
                }
            });
        }
    </script>

</body>

</html>